<!DOCTYPE html>
<html>
<head>
  <title>Vonage In-App Chat</title>
  <script src="https://cdn.jsdelivr.net/npm/@vonage/client-sdk@1.4.0/dist/client-sdk.min.js"></script>
  <style>
    #chat { border: 1px solid #ccc; width: 400px; height: 400px; overflow-y: scroll; padding: 10px; }
    #input { margin-top: 10px; }
  </style>
</head>
<body>
  <h3>Vonage In-App Chat</h3>
  <div id="chat"></div>
  <div id="input">
    <input type="text" id="message" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const chatDiv = document.getElementById('chat');
    let conversation;

    function appendMessage(text, from) {
      const msg = document.createElement('div');
      msg.textContent = `${from}: ${text}`;
      chatDiv.appendChild(msg);
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('message');
      const text = input.value.trim();
      if (text && conversation) {
        conversation.sendText(text);
        appendMessage(text, 'You');
        input.value = '';
      }
    }

    async function startChat() {
      const JWT = 'YOUR_JWT_TOKEN'; // Preferably fetched from your backend
      const applicationId = '1a5f7465-eeb1-481c-93e7-23bbd2a13d63';

      const user = new NexmoClient({ debug: true });
      const session = await user.login(JWT);

      const conv = await session.getConversation('CONVERSATION_ID');
      conversation = conv;

      conv.on('text', (sender, message) => {
        if (sender.user.name !== session.user.name) {
          appendMessage(message.body.text, sender.user.name);
        }
      });
    }

    startChat();
  </script>
</body>
</html>
